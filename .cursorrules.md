# üß† Regras e contexto do projeto Karu√° CRM

Estas instru√ß√µes definem **como o Cursor deve gerar c√≥digo** neste projeto.  
Sempre siga estas regras ao criar novos m√≥dulos, servi√ßos, entidades ou endpoints.

---

## ü™∂ Contexto geral

- O projeto se chama **Karu√° CRM** ‚Äî uma API para hot√©is e pousadas, focada em:
  - Gerenciamento de quartos e tarifas.
  - Reservas (criar, atualizar, cancelar e listar).
  - Cadastro de clientes e hist√≥rico.
- O backend √© a prioridade neste momento. O front-end ser√° desenvolvido depois.

---

## üì¶ Stack e ferramentas

- **Backend:** NestJS (TypeScript)
- **ORM:** TypeORM
- **Banco:** PostgreSQL
- **Cache:** Redis
- **Workflows:** Temporal.io
- **Infra:** Docker / Docker Compose

---

## üß± Regras de arquitetura

- Cada funcionalidade deve ser criada como **um m√≥dulo NestJS independente** dentro de `src/modules/`.
- Respeite o padr√£o: `controller` ‚Üí `service` ‚Üí `repository`.
- Use **DTOs** com `class-validator` e `class-transformer` em todas as rotas p√∫blicas.
- Sempre documente endpoints com **Swagger decorators**.
- Use **dependency injection** para todos os servi√ßos.
- Nunca acesse o banco diretamente em um controller ‚Äî apenas via service/repository.

---

## üóÉÔ∏è Banco de dados

- Nome de tabelas e colunas: `snake_case`
- Tipo de chave prim√°ria: `uuid` com `gen_random_uuid()`
- Inclua sempre: `created_at`, `updated_at`, e `deleted_at` (quando aplic√°vel)
- Defina relacionamentos com `@ManyToOne`, `@OneToMany` etc. com `onDelete` apropriado.
- Utilize **migrations** para todas as mudan√ßas no schema.
- N√£o use `synchronize: true` em produ√ß√£o.

Consulte `docs/DB_SCHEMA.md` antes de criar novas entidades.

---

## üìö Documenta√ß√£o existente

Antes de gerar c√≥digo ou criar novas estruturas, leia e respeite os seguintes arquivos:

- `docs/0001-technical-basis.md` ‚Äî vis√£o geral do projeto e decis√µes de arquitetura.
- `docs/database.md` ‚Äî modelo de dados e tabelas do PostgreSQL.
- `docs/API.md` ‚Äî contratos e estrutura dos endpoints.

---

## üß™ Boas pr√°ticas adicionais

- Use `PascalCase` para classes, `camelCase` para vari√°veis e m√©todos.
- Exce√ß√µes personalizadas devem herdar de `HttpException`.
- Sempre trate erros no service e propague mensagens claras ao controller.
- Logs devem ser estruturados e conter contexto (ex.: `reservationId`, `clientId`).
- Sempre que poss√≠vel, escreva **testes unit√°rios** para services e **E2E** para endpoints cr√≠ticos.

---

‚úÖ **Resumo para o Cursor:**
> Sempre leia este `.cursorrules.md` e os arquivos em `docs/` antes de gerar c√≥digo.  
> Respeite as decis√µes de arquitetura, nomenclatura e modelagem.  
> Quando for necess√°rio criar novas tabelas, entidades ou rotas, baseie-se nas regras acima e na documenta√ß√£o existente.
